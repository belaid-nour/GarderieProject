<section class="content">
  <div class="content-block">
    <div class="block-header">
      <app-breadcrumb
        [title]="breadscrums[0].title"
        [items]="breadscrums[0].items"
        [active_item]="breadscrums[0].active">
      </app-breadcrumb>
    </div>

    <!-- ‚úÖ MESSAGE DE BIENVENUE POUR L'ENSEIGNANT -->
    <div class="welcome-message mat-elevation-z1">
      <mat-icon>emoji_people</mat-icon>
      <div>
        <h3>Bienvenue cher enseignant üë®‚Äçüè´</h3>
        <p>Vous pouvez g√©rer les absences et les √©valuations de vos s√©ances ici. Merci pour votre travail !</p>
      </div>
    </div>

    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="materialTableHeader">
            <div class="left">
              <ul class="header-buttons-left">
                <li class="tbl-title">
                  <h2>
                    <mat-icon>calendar_today</mat-icon>
                    Mes S√©ances
                  </h2>
                </li>
              </ul>
            </div>
            <div class="right">
              <div class="filter-group">
                <button mat-stroked-button
                        *ngFor="let filter of filters"
                        [class.active]="activeFilter === filter.key"
                        (click)="applyFilter(filter.key)">
                  {{filter.label}}
                </button>
              </div>
            </div>
          </div>

          <div class="overflow-auto responsive_table">
            <div class="loading-state" *ngIf="isLoading">
              <mat-spinner diameter="40"></mat-spinner>
            </div>

            <div class="error-state mat-elevation-z1" *ngIf="!isLoading && errorMessage">
              <mat-icon>error</mat-icon>
              <p>{{ errorMessage }}</p>
            </div>

            <div *ngIf="!isLoading && !errorMessage">
              <table mat-table [dataSource]="filteredSeances" class="seance-table">

                <!-- Nom Column -->
                <ng-container matColumnDef="nom">
                  <th mat-header-cell *matHeaderCellDef>Nom</th>
                  <td mat-cell *matCellDef="let seance" class="seance-name">
                    <mat-icon>title</mat-icon>
                    {{ seance.nom || '-' }}
                  </td>
                </ng-container>

                <!-- Classe Column -->
                <ng-container matColumnDef="classe">
                  <th mat-header-cell *matHeaderCellDef>Classe</th>
                  <td mat-cell *matCellDef="let seance">
                    <div class="class-info">
                      <mat-icon>school</mat-icon>
                      {{ seance.classe?.nom || '-' }}
                    </div>
                  </td>
                </ng-container>

                <!-- ‚úÖ S√©paration Horaire -->
                <ng-container matColumnDef="horaire">
                  <th mat-header-cell *matHeaderCellDef>Horaire</th>
                  <td mat-cell *matCellDef="let seance" class="time-cell">
                    <mat-icon>schedule</mat-icon>
                    <span>{{ formatTime(seance.horaireDebut) }}</span>
                    <span *ngIf="seance.horaireFin"> - {{ formatTime(seance.horaireFin) }}</span>
                  </td>
                </ng-container>

                <!-- ‚úÖ Date s√©par√©e -->
                <ng-container matColumnDef="date">
                  <th mat-header-cell *matHeaderCellDef>Date</th>
                  <td mat-cell *matCellDef="let seance" class="date-cell">
                    <mat-icon>event</mat-icon>
                    {{ formatDate(seance.startDate) }}
                  </td>
                </ng-container>

                <!-- Lieu Column -->
                <ng-container matColumnDef="lieu">
                  <th mat-header-cell *matHeaderCellDef>Lieu</th>
                  <td mat-cell *matCellDef="let seance">
                    <div class="location-info">
                      <mat-icon>place</mat-icon>
                      {{ seance.lieu || '-' }}
                    </div>
                  </td>
                </ng-container>

                <!-- Actions Column -->
                <ng-container matColumnDef="actions">
                  <th mat-header-cell *matHeaderCellDef>Actions</th>
                  <td mat-cell *matCellDef="let seance">
                    <div class="action-buttons">
                      <button mat-icon-button
        class="absence-btn"
        (click)="manageAbsence(seance)"
        matTooltip="G√©rer les absences">
  <mat-icon>people_alt</mat-icon>
</button>
                     <button mat-icon-button
        class="evaluation-btn"
        (click)="manageEvaluation(seance)"
        matTooltip="G√©rer les √©valuations">
  <mat-icon>grading</mat-icon>
</button>
                    </div>
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
              </table>

              <div *ngIf="filteredSeances.length === 0" class="empty-state mat-elevation-z1">
                <mat-icon>event_busy</mat-icon>
                <h3>Aucune s√©ance trouv√©e</h3>
                <p>Essayez de modifier les filtres de recherche</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
